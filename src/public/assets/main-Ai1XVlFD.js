import{createElementBlock as m,openBlock as h,normalizeClass as w,createElementVNode as i,createTextVNode as r,withDirectives as d,vModelText as p,withKeys as y,normalizeStyle as k,vShow as u,toDisplayString as x,withModifiers as g}from"vue";let T=biigle.$require("messages").handleErrorResponse,C=biigle.$require("core.mixins.loader"),E=biigle.$require("uiv.tab"),N=biigle.$require("uiv.tabs"),S=biigle.$require("resource");const b=S("api/v1/tags",{},{delete:{method:"DELETE",url:"api/v1/tags/{id}"},update:{method:"PUT",url:"api/v1/tags/{id}"},getAnnotation:{method:"GET",url:"api/v1/tags/annotation/{id}"},attachTag:{method:"POST",url:"api/v1/tags/annotation/{id}"},detachTag:{method:"DELETE",url:"api/v1/tags/annotation/{id}"},updateTag:{method:"PUT",url:"api/v1/tags/annotation/{id}"},importTags:{method:"POST",url:"api/v1/tags/import"}});let c=[0,.5,.9],M=[360,1,1],L=[0,2,2],D=function(e){let t=e[0]/60,o=Math.floor(t),a=t-o,n=[e[2]*(1-e[1]),e[2]*(1-e[1]*a),e[2]*(1-e[1]*(1-a))],s;switch(o){case 1:s=[n[1],e[2],n[0]];break;case 2:s=[n[0],e[2],n[2]];break;case 3:s=[n[0],n[1],e[2]];break;case 4:s=[n[2],n[0],e[2]];break;case 5:s=[e[2],n[0],n[1]];break;default:s=[e[2],n[2],n[0]]}return s.map(function(l){return Math.round(l*255)})},H=function(e){return e.map(function(t){return t=t.toString(16),t.length===1?"0"+t:t})},f=function(){let e=[0,0,0],t;for(let o=e.length-1;o>=0;o--)t=10*L[o],e[o]=(M[o]-c[o])*Math.random()+c[o],t!==0?e[o]=Math.round(e[o]*t)/t:e[o]=Math.round(e[o]);return"#"+H(D(e)).join("")};const v=(e,t)=>{const o=e.__vccOpts||e;for(const[a,n]of t)o[a]=n;return o},q={name:"tag-item",data(){return{hover:!1,editing:!1,oldName:"",oldColor:"",newName:"",newColor:""}},props:{tag:{type:Object,required:!0}},computed:{showColor(){return!0},classObject(){return{"label-tree-label--editing":this.editing}},colorStyle(){return{"background-color":"#"+this.tag.color}},showEditButton(){return this.hover&&!this.editing},editTitle(){return"Edit tag "+this.tag.name},deleteTitle(){return"Remove tag "+this.tag.name}},methods:{editThis(){this.editing=!0,this.oldName=this.tag.name,this.oldColor=this.tag.color,this.newName=this.tag.name,this.newColor="#"+this.tag.color},doHover(){this.hover=!0},dontHover(){this.hover=!1},saveThis(){this.tag.name=this.newName,this.tag.color=this.newColor.substr(1),this.editing=!1,(this.oldName!==this.tag.name||this.oldColor!==this.tag.color)&&this.emitSave(this.tag,()=>this.editing=!0)},revertThis(){this.editing=!1,this.tag.name=this.oldName,this.tag.color=this.oldColor},deleteThis(){this.emitDelete(this.tag)},emitDelete(e){this.$emit("delete",e)},emitSave(e,t){this.$emit("save",e,t)}},created(){console.log(f())}},F={key:0},R={key:1},I=["textContent"],O={class:"label-tree-label__buttons"},A=["title"],U=["title"];function V(e,t,o,a,n,s){return h(),m("li",{class:w(["label-tree-label",s.classObject])},[i("div",{class:"label-tree-label__name",onMouseover:t[8]||(t[8]=(...l)=>s.doHover&&s.doHover(...l)),onMouseleave:t[9]||(t[9]=(...l)=>s.dontHover&&s.dontHover(...l))},[n.editing?(h(),m("span",F,[d(i("input",{type:"color",class:"form-control input-sm label-tree-color-input","onUpdate:modelValue":t[0]||(t[0]=l=>n.newColor=l)},null,512),[[p,n.newColor]]),t[10]||(t[10]=r()),d(i("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=l=>n.newName=l),onKeydown:t[2]||(t[2]=y((...l)=>s.saveThis&&s.saveThis(...l),["enter"])),class:"form-control input-sm label-tree-label__name-input"},null,544),[[p,n.newName]])])):(h(),m("span",R,[d(i("span",{class:"label-tree-label__color",style:k(s.colorStyle)},null,4),[[u,s.showColor]]),t[11]||(t[11]=r()),i("span",{textContent:x(o.tag.name),onMouseenter:t[3]||(t[3]=(...l)=>s.dontHover&&s.dontHover(...l))},null,40,I)])),t[19]||(t[19]=r()),i("span",O,[i("span",null,[d(i("button",{title:s.editTitle,onClick:t[4]||(t[4]=g((...l)=>s.editThis&&s.editThis(...l),["stop"])),class:"btn btn-default btn-xs"},[...t[12]||(t[12]=[i("span",{"aria-hidden":"true",class:"fa fa-pencil-alt"},null,-1)])],8,A),[[u,s.showEditButton]]),t[16]||(t[16]=r()),d(i("button",{title:s.deleteTitle,onClick:t[5]||(t[5]=g((...l)=>s.deleteThis&&s.deleteThis(...l),["stop"])),class:"btn btn-danger btn-sm"},[...t[13]||(t[13]=[i("span",{"aria-hidden":"true",class:"fa fa-trash"},null,-1)])],8,U),[[u,n.editing]]),t[17]||(t[17]=r()),d(i("button",{title:"Save changes",onClick:t[6]||(t[6]=g((...l)=>s.saveThis&&s.saveThis(...l),["stop"])),class:"btn btn-success btn-sm"},[...t[14]||(t[14]=[i("span",{"aria-hidden":"true",class:"fa fa-check"},null,-1)])],512),[[u,n.editing]]),t[18]||(t[18]=r()),d(i("button",{title:"Revert changes",onClick:t[7]||(t[7]=g((...l)=>s.revertThis&&s.revertThis(...l),["stop"])),class:"btn btn-default btn-sm"},[...t[15]||(t[15]=[i("span",{"aria-hidden":"true",class:"fa fa-times"},null,-1)])],512),[[u,n.editing]])])])],32)],2)}const j=v(q,[["render",V]]),P={data(){return{name:"",color:f()}},computed:{hasNoName(){return!this.name}},methods:{refreshColor(){this.color=f()},submit(){let e={name:this.name,color:this.color.substr(1)};this.name="",this.color=f(),this.$emit("submit",e)}}},B={class:"row"},z={class:"col-xs-4 form-group"},G={class:"input-group"},K={class:"input-group-btn"},X={class:"col-xs-4 form-group"},J={class:"input-group"},Q={class:"input-group-btn"},W=["disabled"];function Y(e,t,o,a,n,s){return h(),m("form",{onSubmit:t[3]||(t[3]=g((...l)=>s.submit&&s.submit(...l),["prevent"]))},[i("div",B,[t[8]||(t[8]=i("div",{class:"col-xs-12 help-block"},`
                To add a new tag, choose a color and a name.
            `,-1)),t[9]||(t[9]=r()),i("div",z,[i("div",G,[d(i("input",{type:"color",class:"form-control",title:"Label color","onUpdate:modelValue":t[0]||(t[0]=l=>n.color=l)},null,512),[[p,n.color]]),t[5]||(t[5]=r()),i("span",K,[i("button",{class:"btn btn-default",type:"button",title:"Get a random color",onClick:t[1]||(t[1]=(...l)=>s.refreshColor&&s.refreshColor(...l))},[...t[4]||(t[4]=[i("span",{class:"fa fa-sync-alt","aria-hidden":"true"},null,-1)])])])])]),t[10]||(t[10]=r()),i("div",X,[i("div",J,[d(i("input",{type:"text",class:"form-control",placeholder:"Tag name",title:"New tag name","onUpdate:modelValue":t[2]||(t[2]=l=>n.name=l)},null,512),[[p,n.name]]),t[7]||(t[7]=r()),i("span",Q,[i("button",{class:"btn btn-success",type:"submit",title:"Add the new tag",disabled:s.hasNoName},[...t[6]||(t[6]=[i("span",{class:"fa fa-plus","aria-hidden":"true"},null,-1)])],8,W)])])])])],32)}const Z=v(P,[["render",Y]]),$={mixins:[C],data(){return{error:!1,success:!1,data:null}},methods:{handleSuccess(){this.error=!1,this.success=!0,this.$emit("refresh")},handleError(e){this.success=!1;let t=e.body.errors&&e.body.errors.file;t?Array.isArray(t)?this.error=t[0]:this.error=t:this.handleErrorResponse(e)},handleFile(e){this.startLoading(),this.data=e.target.files[0],console.log(this.data)},handleFinally(){this.data=null,this.finishLoading()},importTags(){let e=new FormData;e.append("file",this.data),b.importTags(e).then(this.handleSuccess).catch(this.handleError).finally(this.handleFinally)}}},_={class:"form-group"},tt=["disabled"];function et(e,t,o,a,n,s){return h(),m("div",_,[t[2]||(t[2]=i("label",null,"Select a file",-1)),t[3]||(t[3]=r()),i("input",{type:"file",name:"import",onChange:t[0]||(t[0]=(...l)=>s.handleFile&&s.handleFile(...l))},null,32),t[4]||(t[4]=r()),t[5]||(t[5]=i("span",{class:"help-block"},`
            The file must be a textfile with a tags separated by newline
        `,-1)),t[6]||(t[6]=r()),i("button",{class:"btn btn-success",onClick:t[1]||(t[1]=(...l)=>s.importTags&&s.importTags(...l)),disabled:!n.data},"Click !",8,tt)])}const st=v($,[["render",et]]),lt={mixins:[C],data(){return{tags:[]}},components:{tagItem:j,tagForm:Z,tagImport:st,tabs:N,tab:E},methods:{saveTag(e,t){b.update({id:e.id},{name:e.name,color:e.color}).catch(function(o){t(),T(o)}).finally(this.finishLoading)},deleteTag(e){this.startLoading(),b.delete({id:e.id}).then(()=>{this.tagDeleted(e)},T)},tagDeleted(e){for(let t=this.tags.length-1;t>=0;t--)if(this.tags[t].id===e.id){this.tags.splice(t,1);break}},createTag(e){this.loading||(console.log(e),this.startLoading(),b.save({},e).then(this.tagCreated,T).finally(this.finishLoading))},tagCreated(e){this.insertTag(e.data)},insertTag(e){let t=e.name.toLowerCase();for(let o=0,a=this.tags.length;o<a;o++)if(this.tags[o].name.toLowerCase()>=t){this.tags.splice(o,0,e);return}this.tags.push(e)},refresh(){console.log("refresh tags")}},created(){this.tags=biigle.$require("tagsDisplay.tags")}};biigle.$mount("tags-container",lt);console.log("Hello from main.js");
