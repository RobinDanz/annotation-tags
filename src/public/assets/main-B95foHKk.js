import{defineComponent as ne,ref as H,watch as ie,onMounted as ae,h as me,reactive as fe,resolveComponent as _,createBlock as re,openBlock as p,withKeys as T,normalizeStyle as de,withCtx as te,createElementVNode as i,normalizeClass as B,withModifiers as m,toDisplayString as I,createElementBlock as h,createCommentVNode as G,withDirectives as f,vModelText as V,Fragment as $,renderList as X,renderSlot as be,onBeforeUnmount as ve,createVNode as N,Teleport as ye,createTextVNode as u,vShow as E}from"vue";function we(t){return typeof t<"u"&&t!==null}function Te(t,e,o){return o.indexOf(t)===e}const x={CLICK:"click",KEY_DOWN:"keydown",TOUCH_END:"touchend"};function P(t,e,o){t.addEventListener(e,o)}function R(t,e,o){t.removeEventListener(e,o)}function Q(t){return t&&t.nodeType===Node.ELEMENT_NODE}function D(t,e){Q(t)&&t.classList.add(e)}function q(t,e){Q(t)&&t.classList.remove(e)}function Oe(t,e,o={}){const a=document.documentElement,n=(window.pageXOffset||a.scrollLeft)-(a.clientLeft||0),l=(window.pageYOffset||a.scrollTop)-(a.clientTop||0),r=e.getBoundingClientRect(),s=t.getBoundingClientRect();if(t.style.right="auto",t.style.bottom="auto",o.menuRight){const g=n+r.left+r.width-s.width;t.style.left=g<0?0:g+"px"}else t.style.left=n+r.left+"px";o.dropup?t.style.top=l+r.top-s.height-4+"px":t.style.top=l+r.top+r.height+"px"}function j(t){Q(t)&&(t.getAttribute("tabindex")||t.setAttribute("tabindex","-1"),t.focus())}ne({props:{tag:{type:String,default:"div"},modelValue:{type:Boolean,default:!1},transition:{type:Number,default:350}},emits:["show","shown","hide","hidden"],setup(t,{emit:e,slots:o}){const a="collapse",l="collapsing";let r=0;const s=H(null);function g(){const v=t.modelValue,d=s.value;if(clearTimeout(r),!!d)if(v){e("show"),q(d,a),d.style.height="auto";const b=window.getComputedStyle(d).height;d.style.height=null,D(d,l),d.offsetHeight,d.style.height=b,r=setTimeout(()=>{q(d,l),D(d,a),D(d,"in"),d.style.height=null,r=0,e("shown")},t.transition)}else e("hide"),d.style.height=window.getComputedStyle(d).height,q(d,"in"),q(d,a),d.offsetHeight,d.style.height=null,D(d,l),r=setTimeout(()=>{D(d,a),q(d,l),d.style.height=null,r=0,e("hidden")},t.transition)}return ie(()=>t.modelValue,()=>{g()}),ae(()=>{t.modelValue&&D(s.value,"in")}),()=>{var v;return me(t.tag,{ref:s,class:a},(v=o.default)==null?void 0:v.call(o))}}});const le="div",Ce=ne({props:{tag:{type:String,default:le},appendToBody:{type:Boolean,default:!1},modelValue:Boolean,dropup:{type:Boolean,default:!1},menuRight:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},notCloseElements:{type:Array,default:()=>[]},positionElement:{type:null,default:void 0}},emits:["update:modelValue"],setup(t,{emit:e,slots:o}){const a=H(!1),n=H(void 0),l=H(null),r=H(null);function s(){var c;return(c=l.value)==null?void 0:c.querySelector("li > a:focus")}function g(c){var y,w;if(a.value){const A=l.value,O=c.keyCode;if(O===27)d(!1),(y=n.value)==null||y.focus();else if(O===13)(w=s())==null||w.click();else if(O===38||O===40){c.preventDefault(),c.stopPropagation();const M=s(),C=A.querySelectorAll("li:not(.disabled) > a");if(!M)j(C[0]);else for(let k=0;k<C.length;k++)if(M===C[k]){O===38&&k<C.length>0?j(C[k-1]):O===40&&k<C.length-1&&j(C[k+1]);break}}}}function v(){var c,y,w;const A=((c=r.value)==null?void 0:c.querySelector('[data-role="trigger"]'))||((y=r.value)==null?void 0:y.querySelector(".dropdown-toggle"))||((w=r.value)==null?void 0:w.firstChild);n.value=A&&A!==l.value?A:null}function d(c){var y;if(!t.disabled){if(typeof c=="boolean"?a.value=c:a.value=!a.value,t.appendToBody)if(a.value){l.value.style.display="block";const w=t.positionElement||r.value;Oe(l.value,w,t)}else(y=l.value)==null||y.removeAttribute("style");e("update:modelValue",a.value)}}function b(c){var y,w,A;const O=c.target;if(a.value&&O){let M=!1;if(t.notCloseElements)for(let Y=0,he=t.notCloseElements.length;Y<he;Y++){const Z=t.notCloseElements[Y].contains(O);let ee=Z;if(t.appendToBody){const ge=(y=l.value)==null?void 0:y.contains(O),ce=t.notCloseElements.indexOf(r.value)>=0;ee=Z||ge&&ce}if(ee){M=!0;break}}const C=(w=l.value)==null?void 0:w.contains(O),k=((A=r.value)==null?void 0:A.contains(O))&&!C,pe=C&&c.type==="touchend";!k&&!M&&!pe&&d(!1)}}return ae(()=>{v(),n.value&&(P(n.value,x.CLICK,d),P(n.value,x.KEY_DOWN,g)),P(l.value,x.KEY_DOWN,g),P(window,x.CLICK,b),P(window,x.TOUCH_END,b),t.modelValue&&d(!0)}),ve(()=>{n.value&&(R(n.value,x.CLICK,d),R(n.value,x.KEY_DOWN,g)),R(l.value,x.KEY_DOWN,g),R(window,x.CLICK,b),R(window,x.TOUCH_END,b)}),ie(()=>t.modelValue,c=>{d(c)}),()=>{const c=t.tag;return N(c,{ref:r,class:{"btn-group":t.tag===le,dropdown:!t.dropup,dropup:t.dropup,open:a.value}},{default:()=>{var y;return[(y=o.default)==null?void 0:y.call(o),N(ye,{to:"body",disabled:!t.appendToBody||!a.value},{default:()=>{var w;return[N("ul",{ref:l,class:{"dropdown-menu":!0,"dropdown-menu-right":t.menuRight}},[(w=o.dropdown)==null?void 0:w.call(o)])]}})]}})}}}),xe={uiv:{datePicker:{clear:"Clear",today:"Today",month:"Month",month1:"January",month2:"February",month3:"March",month4:"April",month5:"May",month6:"June",month7:"July",month8:"August",month9:"September",month10:"October",month11:"November",month12:"December",year:"Year",week1:"Mon",week2:"Tue",week3:"Wed",week4:"Thu",week5:"Fri",week6:"Sat",week7:"Sun"},timePicker:{am:"AM",pm:"PM"},modal:{cancel:"Cancel",ok:"OK"},multiSelect:{placeholder:"Select...",filterPlaceholder:"Search..."}}};let ke=xe,Se=function(){return"$t"in this?this.$t.apply(this,arguments):null};const Ve=function(t,e){e=e||{};let o;try{if(o=Se.apply(this,arguments),we(o)&&!e.$$locale)return o}catch{}const a=t.split(".");let n=e.$$locale||ke;for(let l=0,r=a.length;l<r;l++){const s=a[l];if(o=n[s],l===r-1)return o;if(!o)return"";n=o}return""},Ae=(t,e)=>{const o=t.__vccOpts||t;for(const[a,n]of e)o[a]=n;return o},Ee={components:{Dropdown:Ce},props:{modelValue:{type:Array,required:!0},options:{type:Array,required:!0},labelKey:{type:String,default:"label"},valueKey:{type:String,default:"value"},limit:{type:Number,default:0},size:{type:String,default:void 0},placeholder:{type:String,default:void 0},split:{type:String,default:", "},disabled:{type:Boolean,default:!1},appendToBody:{type:Boolean,default:!1},block:{type:Boolean,default:!1},collapseSelected:{type:Boolean,default:!1},filterable:{type:Boolean,default:!1},filterAutoFocus:{type:Boolean,default:!0},filterFunction:{type:Function,default:void 0},filterPlaceholder:{type:String,default:void 0},selectedIcon:{type:String,default:"glyphicon glyphicon-ok"},itemSelectedClass:{type:String,default:void 0}},emits:["focus","blur","visible-change","update:modelValue","change","limit-exceed","search"],data(){return{showDropdown:!1,els:[],filterInput:"",currentActive:-1}},computed:{containerStyles(){return{width:this.block?"100%":""}},filteredOptions(){if(this.filterable&&this.filterInput){if(this.filterFunction)return this.filterFunction(this.filterInput);{const t=this.filterInput.toLowerCase();return this.options.filter(e=>e[this.valueKey].toString().toLowerCase().indexOf(t)>=0||e[this.labelKey].toString().toLowerCase().indexOf(t)>=0)}}else return this.options},groupedOptions(){return this.filteredOptions.map(t=>t.group).filter(Te).map(t=>({options:this.filteredOptions.filter(e=>e.group===t),$group:t}))},flattenGroupedOptions(){return[].concat(...this.groupedOptions.map(t=>t.options))},selectClasses(){return{[`input-${this.size}`]:this.size}},selectedIconClasses(){return{[this.selectedIcon]:!0,"pull-right":!0}},selectTextClasses(){return{"text-muted":this.modelValue.length===0}},labelValue(){const t=this.options.map(e=>e[this.valueKey]);return this.modelValue.map(e=>{const o=t.indexOf(e);return o>=0?this.options[o][this.labelKey]:e})},selectedText(){if(this.modelValue.length){const t=this.labelValue;if(this.collapseSelected){let e=t[0];return e+=t.length>1?`${this.split}+${t.length-1}`:"",e}else return t.join(this.split)}else return this.placeholder||this.t("uiv.multiSelect.placeholder")},customOptionsVisible(){return!!this.$slots.option||!!this.$slots.option}},watch:{showDropdown(t){this.filterInput="",this.currentActive=-1,this.$emit("visible-change",t),t&&this.filterable&&this.filterAutoFocus&&this.$nextTick(()=>{this.$refs.filterInput.focus()})}},mounted(){this.els=[this.$el]},methods:{t:Ve,goPrevOption(){this.showDropdown&&(this.currentActive>0?this.currentActive--:this.currentActive=this.flattenGroupedOptions.length-1)},goNextOption(){this.showDropdown&&(this.currentActive<this.flattenGroupedOptions.length-1?this.currentActive++:this.currentActive=0)},selectOption(){const t=this.currentActive,e=this.flattenGroupedOptions;this.showDropdown?t>=0&&t<e.length&&this.toggle(e[t]):this.showDropdown=!0},itemClasses(t){const e={disabled:t.disabled,active:this.currentActive===this.flattenGroupedOptions.indexOf(t)};return this.itemSelectedClass&&(e[this.itemSelectedClass]=this.isItemSelected(t)),e},isItemSelected(t){return this.modelValue.indexOf(t[this.valueKey])>=0},toggle(t){if(t.disabled)return;const e=t[this.valueKey],o=this.modelValue.indexOf(e);if(this.limit===1){const a=o>=0?[]:[e];this.$emit("update:modelValue",a),this.$emit("change",a)}else if(o>=0){const a=this.modelValue.slice();a.splice(o,1),this.$emit("update:modelValue",a),this.$emit("change",a)}else if(this.limit===0||this.modelValue.length<this.limit){const a=this.modelValue.slice();a.push(e),this.$emit("update:modelValue",a),this.$emit("change",a)}else this.$emit("limit-exceed")},searchClicked(){this.$emit("search",this.filterInput)}}},Le=["disabled"],Ne=i("div",{class:"pull-right",style:{display:"inline-block","vertical-align":"middle"}},[i("span",null,"Â "),i("span",{class:"caret"})],-1),Ie=["textContent"],_e={key:0,style:{padding:"4px 8px"}},De=["placeholder"],Be=["textContent"],Ge=["onClick"],Ke={key:0,role:"button",style:{outline:"0"}},Me={key:1,role:"button",style:{outline:"0"}},Pe={key:2,role:"button",style:{outline:"0"}};function Re(t,e,o,a,n,l){const r=_("dropdown");return p(),re(r,{ref:"dropdown",modelValue:n.showDropdown,"onUpdate:modelValue":e[14]||(e[14]=s=>n.showDropdown=s),"not-close-elements":n.els,"append-to-body":o.appendToBody,disabled:o.disabled,style:de(l.containerStyles),onKeydown:e[15]||(e[15]=T(s=>n.showDropdown=!1,["esc"]))},{dropdown:te(()=>[o.filterable?(p(),h("li",_e,[f(i("input",{ref:"filterInput","onUpdate:modelValue":e[5]||(e[5]=s=>n.filterInput=s),"aria-label":"Filter...",class:"form-control input-sm",type:"text",placeholder:o.filterPlaceholder||l.t("uiv.multiSelect.filterPlaceholder"),onKeyup:e[6]||(e[6]=T((...s)=>l.searchClicked&&l.searchClicked(...s),["enter"])),onKeydown:[e[7]||(e[7]=T(m((...s)=>l.goNextOption&&l.goNextOption(...s),["prevent","stop"]),["down"])),e[8]||(e[8]=T(m((...s)=>l.goPrevOption&&l.goPrevOption(...s),["prevent","stop"]),["up"])),e[9]||(e[9]=T(m((...s)=>l.selectOption&&l.selectOption(...s),["prevent","stop"]),["enter"]))]},null,40,De),[[V,n.filterInput]])])):G("",!0),(p(!0),h($,null,X(l.groupedOptions,(s,g)=>(p(),h($,null,[s.$group?(p(),h("li",{key:g,class:"dropdown-header",textContent:I(s.$group)},null,8,Be)):G("",!0),(p(!0),h($,null,X(s.options,(v,d)=>(p(),h("li",{key:`${g}_${d}`,class:B(l.itemClasses(v)),style:{outline:"0"},onKeydown:[e[10]||(e[10]=T(m((...b)=>l.goNextOption&&l.goNextOption(...b),["prevent","stop"]),["down"])),e[11]||(e[11]=T(m((...b)=>l.goPrevOption&&l.goPrevOption(...b),["prevent","stop"]),["up"])),e[12]||(e[12]=T(m((...b)=>l.selectOption&&l.selectOption(...b),["prevent","stop"]),["enter"]))],onClick:m(b=>l.toggle(v,b),["stop"]),onMouseenter:e[13]||(e[13]=b=>n.currentActive=-1)},[l.customOptionsVisible?(p(),h("a",Ke,[be(t.$slots,"option",{item:v}),o.selectedIcon&&l.isItemSelected(v)?(p(),h("span",{key:0,class:B(l.selectedIconClasses)},null,2)):G("",!0)])):l.isItemSelected(v)?(p(),h("a",Me,[i("b",null,I(v[o.labelKey]),1),o.selectedIcon?(p(),h("span",{key:0,class:B(l.selectedIconClasses)},null,2)):G("",!0)])):(p(),h("a",Pe,[i("span",null,I(v[o.labelKey]),1)]))],42,Ge))),128))],64))),256))]),default:te(()=>[i("div",{class:B(["form-control dropdown-toggle clearfix",l.selectClasses]),disabled:o.disabled?!0:void 0,tabindex:"0","data-role":"trigger",onFocus:e[0]||(e[0]=s=>t.$emit("focus",s)),onBlur:e[1]||(e[1]=s=>t.$emit("blur",s)),onKeydown:[e[2]||(e[2]=T(m((...s)=>l.goNextOption&&l.goNextOption(...s),["prevent","stop"]),["down"])),e[3]||(e[3]=T(m((...s)=>l.goPrevOption&&l.goPrevOption(...s),["prevent","stop"]),["up"])),e[4]||(e[4]=T(m((...s)=>l.selectOption&&l.selectOption(...s),["prevent","stop"]),["enter"]))]},[Ne,i("div",{class:B(l.selectTextClasses),style:{"overflow-x":"hidden","text-overflow":"ellipsis","white-space":"nowrap"},textContent:I(l.selectedText)},null,10,Ie)],42,Le)]),_:3},8,["modelValue","not-close-elements","append-to-body","disabled","style"])}const F=Ae(Ee,[["render",Re]]),U={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right"};fe({[U.TOP_LEFT]:[],[U.TOP_RIGHT]:[],[U.BOTTOM_LEFT]:[],[U.BOTTOM_RIGHT]:[]});const K=(t,e)=>{const o=t.__vccOpts||t;for(const[a,n]of e)o[a]=n;return o},qe={name:"tag-item",components:{multiSelect:F},data(){return{hover:!1,editing:!1,oldValue:"",oldName:"",oldColor:"",newValue:"",newName:"",newColor:"",oldAllowedLabels:[],newAllowedLabels:[],labelsOptions:[]}},props:{tag:{type:Object,required:!0}},computed:{showColor(){return!0},classObject(){return{"label-tree-label--editing":this.editing}},colorStyle(){return{"background-color":"#"+this.tag.color}},showEditButton(){return this.hover&&!this.editing},editTitle(){return"Edit tag "+this.tag.name},deleteTitle(){return"Remove tag "+this.tag.name}},methods:{editThis(){this.editing=!0,this.oldValue=this.tag.value,this.oldName=this.tag.name,this.oldColor=this.tag.color,this.oldAllowedLabels=this.tag.label_ids,this.newValue=this.tag.value,this.newName=this.tag.name,this.newColor="#"+this.tag.color,this.newAllowedLabels=this.tag.label_ids},doHover(){this.hover=!0},dontHover(){this.hover=!1},saveThis(){this.tag.name=this.newName,this.tag.value=this.newValue,this.tag.color=this.newColor.substr(1),this.tag.label_ids=this.newAllowedLabels,this.editing=!1,(this.oldName!==this.tag.name||this.oldValue!==this.tag.value||this.oldColor!==this.tag.color||this.oldAllowedLabels!==this.tag.label_ids)&&this.emitSave(this.tag,()=>this.editing=!0)},revertThis(){this.editing=!1,this.tag.name=this.oldName,this.tag.value=this.oldValue,this.tag.color=this.oldColor,this.tag.label_ids=this.oldAllowedLabels},deleteThis(){this.emitDelete(this.tag)},emitDelete(t){this.$emit("delete",t)},emitSave(t,e){this.$emit("save",t,e)}},created(){biigle.$require("tagsDisplay.labels").forEach(e=>{this.labelsOptions.push({value:e.id,label:e.name})})}},He={key:0},Fe={key:1},Ue=["textContent"],$e={class:"label-tree-label__buttons"},ze=["title"],Ye=["title"];function je(t,e,o,a,n,l){const r=_("multi-select");return p(),h("li",{class:B(["label-tree-label",l.classObject])},[i("div",{class:"label-tree-label__name",onMouseover:e[11]||(e[11]=(...s)=>l.doHover&&l.doHover(...s)),onMouseleave:e[12]||(e[12]=(...s)=>l.dontHover&&l.dontHover(...s))},[n.editing?(p(),h("span",He,[f(i("input",{type:"color",class:"form-control input-sm label-tree-color-input","onUpdate:modelValue":e[0]||(e[0]=s=>n.newColor=s)},null,512),[[V,n.newColor]]),e[13]||(e[13]=u()),f(i("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>n.newName=s),onKeydown:e[2]||(e[2]=T((...s)=>l.saveThis&&l.saveThis(...s),["enter"])),class:"form-control input-sm label-tree-label__name-input"},null,544),[[V,n.newName]]),e[14]||(e[14]=u()),f(i("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>n.newValue=s),onKeydown:e[4]||(e[4]=T((...s)=>l.saveThis&&l.saveThis(...s),["enter"])),class:"form-control input-sm label-tree-label__name-input"},null,544),[[V,n.newValue]]),e[15]||(e[15]=u()),N(r,{size:"sm",modelValue:n.newAllowedLabels,"onUpdate:modelValue":e[5]||(e[5]=s=>n.newAllowedLabels=s),options:n.labelsOptions,"selected-icon":"fa fa-check",filterable:"","collapse-selected":""},null,8,["modelValue","options"])])):(p(),h("span",Fe,[f(i("span",{class:"label-tree-label__color",style:de(l.colorStyle)},null,4),[[E,l.showColor]]),e[16]||(e[16]=u()),i("span",{textContent:I(o.tag.name),onMouseenter:e[6]||(e[6]=(...s)=>l.dontHover&&l.dontHover(...s))},null,40,Ue)])),e[24]||(e[24]=u()),i("span",$e,[i("span",null,[f(i("button",{title:l.editTitle,onClick:e[7]||(e[7]=m((...s)=>l.editThis&&l.editThis(...s),["stop"])),class:"btn btn-default btn-xs"},[...e[17]||(e[17]=[i("span",{"aria-hidden":"true",class:"fa fa-pencil-alt"},null,-1)])],8,ze),[[E,l.showEditButton]]),e[21]||(e[21]=u()),f(i("button",{title:l.deleteTitle,onClick:e[8]||(e[8]=m((...s)=>l.deleteThis&&l.deleteThis(...s),["stop"])),class:"btn btn-danger btn-sm"},[...e[18]||(e[18]=[i("span",{"aria-hidden":"true",class:"fa fa-trash"},null,-1)])],8,Ye),[[E,n.editing]]),e[22]||(e[22]=u()),f(i("button",{title:"Save changes",onClick:e[9]||(e[9]=m((...s)=>l.saveThis&&l.saveThis(...s),["stop"])),class:"btn btn-success btn-sm"},[...e[19]||(e[19]=[i("span",{"aria-hidden":"true",class:"fa fa-check"},null,-1)])],512),[[E,n.editing]]),e[23]||(e[23]=u()),f(i("button",{title:"Revert changes",onClick:e[10]||(e[10]=m((...s)=>l.revertThis&&l.revertThis(...s),["stop"])),class:"btn btn-default btn-sm"},[...e[20]||(e[20]=[i("span",{"aria-hidden":"true",class:"fa fa-times"},null,-1)])],512),[[E,n.editing]])])])],32)],2)}const We=K(qe,[["render",je],["__scopeId","data-v-0e92d38b"]]);let se=[0,.5,.9],Je=[360,1,1],Xe=[0,2,2],Qe=function(t){let e=t[0]/60,o=Math.floor(e),a=e-o,n=[t[2]*(1-t[1]),t[2]*(1-t[1]*a),t[2]*(1-t[1]*(1-a))],l;switch(o){case 1:l=[n[1],t[2],n[0]];break;case 2:l=[n[0],t[2],n[2]];break;case 3:l=[n[0],n[1],t[2]];break;case 4:l=[n[2],n[0],t[2]];break;case 5:l=[t[2],n[0],n[1]];break;default:l=[t[2],n[2],n[0]]}return l.map(function(r){return Math.round(r*255)})},Ze=function(t){return t.map(function(e){return e=e.toString(16),e.length===1?"0"+e:e})},W=function(){let t=[0,0,0],e;for(let o=t.length-1;o>=0;o--)e=10*Xe[o],t[o]=(Je[o]-se[o])*Math.random()+se[o],e!==0?t[o]=Math.round(t[o]*e)/e:t[o]=Math.round(t[o]);return"#"+Ze(Qe(t)).join("")};const et={components:{multiSelect:F},data(){return{name:"",value:"",labels:[],labelsOptions:[],color:W()}},computed:{hasNoName(){return!this.name}},methods:{refreshColor(){this.color=W()},submit(){let t={name:this.name,value:this.value,color:this.color.substr(1),label_ids:this.labels};this.name="",this.value="",this.color=W(),this.labels=[],this.$emit("submit",t)}},created(){biigle.$require("tagsDisplay.labels").forEach(e=>{this.labelsOptions.push({value:e.id,label:e.name})})}},tt={class:"row"},lt={class:"col-xs-4 form-group"},st={class:"input-group"},ot={class:"input-group-btn"},nt={class:"col-xs-4"},it={class:"col-xs-4 form-group"},at={class:"col-xs-4 form-group"},rt={class:"row"},dt={class:"col-xs-4 form-group"},ut=["disabled"];function pt(t,e,o,a,n,l){const r=_("multi-select");return p(),h("form",{onSubmit:e[5]||(e[5]=m((...s)=>l.submit&&l.submit(...s),["prevent"]))},[i("div",tt,[e[8]||(e[8]=i("div",{class:"col-xs-12 help-block"},`
                To add a new tag, choose a color and a name.
            `,-1)),e[9]||(e[9]=u()),i("div",lt,[i("div",st,[f(i("input",{type:"color",class:"form-control",title:"Label color","onUpdate:modelValue":e[0]||(e[0]=s=>n.color=s)},null,512),[[V,n.color]]),e[7]||(e[7]=u()),i("span",ot,[i("button",{class:"btn btn-default",type:"button",title:"Get a random color",onClick:e[1]||(e[1]=(...s)=>l.refreshColor&&l.refreshColor(...s))},[...e[6]||(e[6]=[i("span",{class:"fa fa-sync-alt","aria-hidden":"true"},null,-1)])])])])]),e[10]||(e[10]=u()),i("div",nt,[f(i("input",{type:"text",class:"form-control",placeholder:"Tag name",title:"New tag name","onUpdate:modelValue":e[2]||(e[2]=s=>n.name=s)},null,512),[[V,n.name]])]),e[11]||(e[11]=u()),i("div",it,[f(i("input",{type:"text",class:"form-control",placeholder:"Tag value",title:"New tag value","onUpdate:modelValue":e[3]||(e[3]=s=>n.value=s)},null,512),[[V,n.value]])]),e[12]||(e[12]=u()),e[13]||(e[13]=i("div",{class:"col-xs-12 help-block"},`
                Optionnaly select a set of labels to use this tag on.
            `,-1)),e[14]||(e[14]=u()),i("div",at,[N(r,{id:"allowed-labels",modelValue:n.labels,"onUpdate:modelValue":e[4]||(e[4]=s=>n.labels=s),options:n.labelsOptions,"selected-icon":"fa fa-check",filterable:"","collapse-selected":"",title:"Allowed labels"},null,8,["modelValue","options"])])]),e[15]||(e[15]=u()),i("div",rt,[i("div",dt,[i("button",{class:"btn btn-success",type:"submit",title:"Add the new tag",disabled:l.hasNoName},`
                    Create new tag
                `,8,ut)])])],32)}const ht=K(et,[["render",pt],["__scopeId","data-v-33a03c0c"]]);let S=biigle.$require("messages").handleErrorResponse,z=biigle.$require("core.mixins.loader"),gt=biigle.$require("uiv.tab"),ct=biigle.$require("uiv.tabs"),ue=biigle.$require("resource");biigle.$require("api.labelTree");let oe=biigle.$require("annotations.components.annotationsTabPlugins");const L=ue("api/v1/tags",{},{delete:{method:"DELETE",url:"api/v1/tags/{id}"},update:{method:"PUT",url:"api/v1/tags/{id}"},getAnnotation:{method:"GET",url:"api/v1/tags/annotations/{id}"},updateRelation:{method:"POST",url:"api/v1/tags/annotations/{id}"},importTags:{method:"POST",url:"api/v1/tags/import"}}),mt={mixins:[z],data(){return{error:!1,success:!1,data:null}},methods:{handleSuccess(){this.error=!1,this.success=!0,this.$emit("refresh")},handleError(t){this.success=!1;let e=t.body.errors&&t.body.errors.file;e?Array.isArray(e)?this.error=e[0]:this.error=e:this.handleErrorResponse(t)},handleFile(t){this.startLoading(),this.data=t.target.files[0],console.log(this.data)},handleFinally(){this.data=null,this.finishLoading()},importTags(){let t=new FormData;t.append("file",this.data),L.importTags(t).then(this.handleSuccess).catch(this.handleError).finally(this.handleFinally)}}},ft={class:"form-group"},bt=["disabled"],vt={key:0,class:"info bg-success text-success"},yt={key:1,class:"info bg-danger text-danger"};function wt(t,e,o,a,n,l){return p(),h("div",ft,[e[2]||(e[2]=i("label",null,"Select a file",-1)),e[3]||(e[3]=u()),i("input",{type:"file",name:"import",onChange:e[0]||(e[0]=(...r)=>l.handleFile&&l.handleFile(...r))},null,32),e[4]||(e[4]=u()),e[5]||(e[5]=i("span",{class:"help-block"},`
            The file must be a textfile with tags separated by newline
        `,-1)),e[6]||(e[6]=u()),i("button",{class:"btn btn-success",onClick:e[1]||(e[1]=(...r)=>l.importTags&&l.importTags(...r)),disabled:!n.data},"Import",8,bt),e[7]||(e[7]=u()),n.success?(p(),h("p",vt,`
            Tags successfully imported. Refresh the page.
        `)):G("",!0),e[8]||(e[8]=u()),n.error?(p(),h("p",yt,`
            There was an error importing the file.
        `)):G("",!0)])}const Tt=K(mt,[["render",wt],["__scopeId","data-v-7e42cad3"]]),Ot={components:{multiSelect:F},props:{group:{type:Object,required:!0},tags:{type:Array,required:!0},new:{type:Boolean,default:!1}},data(){return{hover:!1,editing:!1,oldName:"",oldTags:[],newName:"",newTags:[],tagSelected:[]}},methods:{doHover(){this.hover=!0},dontHover(){this.hover=!1},editThis(){this.editing=!0,this.oldName=this.group.name,this.oldTags=this.group.tags},revertThis(){this.editing=!1,this.group.name=this.oldName,this.group.tags=this.oldTags},deleteThis(){this.$emit("delete",this.group)},saveThis(){this.editing=!1,this.$emit("save",this.group,()=>this.editing=!0)}},computed:{showEditButton(){return this.hover&&!this.editing},editTitle(){return"Edit group "+this.group.name},deleteTitle(){return"Remove group "+this.group.name},tagOptions(){return this.tags.map(t=>(this.group.tags.includes(t.value)&&(t.disabled=!1),t))}}},Ct={key:0},xt={class:"form-group"},kt={class:"form-group"},St={key:1},Vt={class:"group-title row"},At={class:"col-xs-6"},Et={class:"col-xs-6 group-edit-button"},Lt=["title"],Nt={class:"group-subtitle"},It={class:""},_t=["title"];function Dt(t,e,o,a,n,l){const r=_("multi-select");return p(),h("div",{class:"panel panel-default group-container",onMouseover:e[6]||(e[6]=(...s)=>l.doHover&&l.doHover(...s)),onMouseleave:e[7]||(e[7]=(...s)=>l.dontHover&&l.dontHover(...s))},[n.editing?(p(),h("span",Ct,[i("div",xt,[f(i("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>o.group.name=s),class:"form-control input-sm"},null,512),[[V,o.group.name]])]),e[8]||(e[8]=u()),i("div",kt,[N(r,{modelValue:o.group.tags,"onUpdate:modelValue":e[1]||(e[1]=s=>o.group.tags=s),options:l.tagOptions,"selected-icon":"fa fa-check",filterable:"","collapse-selected":""},null,8,["modelValue","options"])])])):(p(),h("span",St,[i("div",Vt,[i("div",At,[i("label",null,I(o.group.name),1)]),e[10]||(e[10]=u()),i("div",Et,[i("button",{title:l.editTitle,onClick:e[2]||(e[2]=m((...s)=>l.editThis&&l.editThis(...s),["stop"])),class:"btn btn-default btn-xs"},[...e[9]||(e[9]=[i("span",{"aria-hidden":"true",class:"fa fa-pencil-alt"},null,-1)])],8,Lt)])]),e[11]||(e[11]=u()),i("label",Nt,I(o.group.tags.length)+" tags selected",1)])),e[17]||(e[17]=u()),i("span",It,[f(i("button",{title:l.deleteTitle,onClick:e[3]||(e[3]=m((...s)=>l.deleteThis&&l.deleteThis(...s),["stop"])),class:"btn btn-danger btn-sm"},[...e[12]||(e[12]=[i("span",{"aria-hidden":"true",class:"fa fa-trash"},null,-1)])],8,_t),[[E,n.editing]]),e[15]||(e[15]=u()),f(i("button",{title:"Save changes",onClick:e[4]||(e[4]=m((...s)=>l.saveThis&&l.saveThis(...s),["stop"])),class:"btn btn-success btn-sm"},[...e[13]||(e[13]=[i("span",{"aria-hidden":"true",class:"fa fa-check"},null,-1)])],512),[[E,n.editing]]),e[16]||(e[16]=u()),f(i("button",{title:"Revert changes",onClick:e[5]||(e[5]=m((...s)=>l.revertThis&&l.revertThis(...s),["stop"])),class:"btn btn-default btn-sm"},[...e[14]||(e[14]=[i("span",{"aria-hidden":"true",class:"fa fa-times"},null,-1)])],512),[[E,n.editing]])])],32)}const Bt=K(Ot,[["render",Dt],["__scopeId","data-v-39988320"]]),J=ue("api/v1/tag-groups",{},{delete:{method:"DELETE",url:"api/v1/tag-groups/{id}"},update:{method:"PUT",url:"api/v1/tag-groups/{id}"}}),Gt={mixins:[z],components:{multiSelect:F,tagGroup:Bt},props:{tags:{type:Array,required:!0}},data(){return{labelSelected:[],labelOptions:[],groups:[],newGroup:{name:"",tags:[]}}},methods:{buildLabelOptions(t){const e={};return e.value=t.id,e.label=t.name,e},groupCreated(t){const e={id:t.data.id,name:t.data.name,tags:t.data.tags.map(o=>o.id)};this.groups.push(e),this.newGroup.name="",this.newGroup.tags=[]},groupDeleted(t){this.groups=this.groups.filter(e=>e.id!=t.id)},createGroup(){this.loading||(this.startLoading(),J.save({},this.newGroup).then(this.groupCreated,S).finally(()=>{this.finishLoading(),this.refreshTags()}))},deleteGroup(t){J.delete({id:t.id}).then(this.groupDeleted(t),S).finally(()=>{this.finishLoading(),this.refreshTags()})},refreshTags(){this.$emit("refresh")},saveGroup(t,e){console.log("save:",t),J.update({id:t.id},{name:t.name,tags:t.tags}).catch(o=>{console.log(o),e(),this.handleErrorResponse(o)}).finally(()=>{console.log("refresh"),this.refreshTags()})},mapTags(t){return t.map(e=>({value:e.id,label:e.name,disabled:!!e.tag_group_id}))}},computed:{tagsOptions(){return this.mapTags(this.tags)},createButtonDisabled(){return this.newGroup.name===""||this.newGroup.tags.length==0}},mounted(){biigle.$require("tagsDisplay.labels").forEach(e=>{this.labelOptions.push(this.buildLabelOptions(e))}),this.groups=biigle.$require("tagsDisplay.groups")}},Kt={class:""},Mt={class:"form-group"},Pt={class:"form-group"},Rt={class:"row"},qt={class:"col-xs-4"},Ht={class:""},Ft={class:"form-group"},Ut=["disabled"];function $t(t,e,o,a,n,l){const r=_("multi-select"),s=_("tag-group");return p(),h("div",Kt,[i("div",Mt,[e[4]||(e[4]=i("label",null,"Create group of mutually exclusive tags",-1)),e[5]||(e[5]=u()),i("div",Pt,[i("div",Rt,[i("div",qt,[f(i("input",{type:"text",class:"form-control",placeholder:"Group name",title:"New group name","onUpdate:modelValue":e[0]||(e[0]=g=>n.newGroup.name=g)},null,512),[[V,n.newGroup.name]])]),e[3]||(e[3]=u()),i("div",Ht,[N(r,{modelValue:n.newGroup.tags,"onUpdate:modelValue":e[1]||(e[1]=g=>n.newGroup.tags=g),options:l.tagsOptions,"selected-icon":"fa fa-check",filterable:"","collapse-selected":""},null,8,["modelValue","options"])])])]),e[6]||(e[6]=u()),i("div",Ft,[i("button",{class:"btn btn-success",onClick:e[2]||(e[2]=(...g)=>l.createGroup&&l.createGroup(...g)),disabled:l.createButtonDisabled},"Create new group",8,Ut)]),e[7]||(e[7]=u()),i("div",null,[(p(!0),h($,null,X(n.groups,g=>(p(),re(s,{key:g.id,group:g,tags:l.tagsOptions,onDelete:l.deleteGroup,onSave:l.saveGroup},null,8,["group","tags","onDelete","onSave"]))),128))])])])}const zt=K(Gt,[["render",$t],["__scopeId","data-v-2f3c7207"]]),Yt={mixins:[z],data(){return{tags:[]}},components:{tagItem:We,tagForm:ht,tagImport:Tt,tagRules:zt,tabs:ct,tab:gt},methods:{saveTag(t,e){L.update({id:t.id},{name:t.name,value:t.value,color:t.color,label_ids:t.label_ids}).catch(function(o){e(),S(o)}).finally(this.finishLoading)},deleteTag(t){this.startLoading(),L.delete({id:t.id}).then(()=>{this.tagDeleted(t)},S)},tagDeleted(t){for(let e=this.tags.length-1;e>=0;e--)if(this.tags[e].id===t.id){this.tags.splice(e,1);break}},createTag(t){this.loading||(this.startLoading(),L.save({},t).then(this.tagCreated,S).finally(this.finishLoading))},tagCreated(t){this.insertTag(t.data)},insertTag(t){let e=t.name.toLowerCase();for(let o=0,a=this.tags.length;o<a;o++)if(this.tags[o].name.toLowerCase()>=e){this.tags.splice(o,0,t);return}this.tags.push(t)},refresh(){this.loading||L.query().then(t=>{this.tags=t.data},S).finally(this.finishLoading)}},created(){this.tags=biigle.$require("tagsDisplay.tags")}},jt={mixins:[z],components:{multiSelect:F},data(){return{tags:[],options:[],selectedOptions:[]}},props:{annotations:{type:Array,required:!0}},methods:{refreshOptions(t){this.options=[],this.tags.forEach(e=>{(e.label_ids.length===0||e.label_ids.includes(t.labels[0].label_id))&&this.options.push({value:e.id,label:e.name,group:e.group?e.group.name:"",disabled:!1})})},disableOptions(){const t=this.selectedOptions.map(e=>{const o=this.options.find(a=>a.value===e);return o?o.group:null}).filter(e=>e);this.options.forEach(e=>{e.disabled=t.includes(e.group)&&!this.selectedOptions.includes(e.value)})},selectedOptionsChanged(t){if(this.selectedAnnotations.length==1){const e=this.selectedAnnotations[0].id;this.updateRelation(t,e)}},getTags(){L.get().then(t=>{this.tags=t.data}).catch(function(t){S(t)})},getAnnotationTags(t){L.getAnnotation({id:t}).then(e=>{for(let o of e.data)this.selectedOptions.push(o.id);this.disableOptions()}).catch(function(e){S(e)})},updateRelation(t,e){L.updateRelation({id:e},{tags:t}).then(this.disableOptions).catch(function(o){S(o)})}},computed:{selectedAnnotations(){return this.annotations.filter(t=>t.selected)},isDisabled(){return this.selectedAnnotations.length!==1}},watch:{selectedAnnotations(){if(this.selectedOptions=[],this.selectedAnnotations.length==1){const t=this.selectedAnnotations[0].id;this.refreshOptions(this.selectedAnnotations[0]),this.getAnnotationTags(t)}}},mounted(){this.getTags()}},Wt={class:"annotation-tags"},Jt={class:"form-group"};function Xt(t,e,o,a,n,l){const r=_("multi-select");return p(),h("div",Wt,[i("div",Jt,[N(r,{class:"tags-multi-select",ref:"refSelect",modelValue:n.selectedOptions,"onUpdate:modelValue":e[0]||(e[0]=s=>n.selectedOptions=s),onChange:l.selectedOptionsChanged,options:n.options,disabled:l.isDisabled,"selected-icon":"fa fa-check",filterable:""},null,8,["modelValue","onChange","options","disabled"])])])}const Qt=K(jt,[["render",Xt],["__scopeId","data-v-2d70c836"]]);oe&&(oe.annotationTags=Qt);biigle.$mount("tags-container",Yt);
